<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Correspondências</title>

  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    :root {
      --primary-color: #1a73e8;
      --primary-hover-color: #1557b0;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --light-bg: #f8f9fa;
      --white: #fff;
      --border: #e0e0e0;
    }
    body { font-family: Arial, sans-serif; margin: 0; background: var(--light-bg); }
    .header { display: flex; justify-content: space-between; align-items: center;
      padding: 1rem 2rem; background: var(--white); border-bottom: 1px solid var(--border); }
    .logo { display: flex; align-items: center; gap: 1rem; }
    .logo-icon { background: var(--primary-color); color: #fff; border-radius: 50%;
      width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; }
    .system-title { font-weight: bold; color: var(--primary-color); }
    .nav { display: flex; gap: 2rem; background: var(--white); padding: 0.5rem 2rem; border-bottom: 1px solid var(--border); }
    .nav a { text-decoration: none; color: #555; padding: 0.5rem; border-bottom: 3px solid transparent; }
    .nav a.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .container { max-width: 1200px; margin: auto; padding: 2rem; }
    .content { display: none; }
    .content.active { display: block; }
    form { margin-bottom: 1.5rem; background: var(--white); padding: 1rem; border-radius: 8px; }
    form input, form select { width: 100%; margin: 0.3rem 0; padding: 8px; }
    form button { background: var(--primary-color); color: #fff; border: none; padding: 10px; margin-top: 0.5rem; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: var(--white); }
    table th, table td { padding: 10px; border: 1px solid var(--border); text-align: left; }
    .btn { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-danger { background: var(--danger-color); color: #fff; }
    .btn-success { background: var(--success-color); color: #fff; }
    .btn-export { background: var(--primary-color); color: #fff; margin: 10px 0; }
    .toast { position: fixed; top: 20px; right: 20px; background: var(--success-color);
      color: #fff; padding: 10px 15px; border-radius: 5px; transform: translateX(200%); transition: .3s; }
    .toast.show { transform: translateX(0); }
    .toast.error { background: var(--danger-color); }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <div class="logo-icon"><i class="fas fa-envelope"></i></div>
      <div>
        <div class="system-title">Sistema de Correspondências</div>
        <div>Condomínio Residencial Algodoeiro</div>
      </div>
    </div>
    <img src="logo_condominio.jpg" alt="Logo" style="max-height:40px;">
  </header>

  <nav class="nav">
    <a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a>
    <a href="#" onclick="showSection('correspondencias')">Correspondências</a>
    <a href="#" onclick="showSection('entregues')">Entregues</a>
    <a href="#" onclick="showSection('moradores')">Moradores</a>
  </nav>

  <div class="container">
    <!-- Dashboard -->
    <div id="dashboard" class="content active">
      <h2>Dashboard</h2>
      <p>Total de Moradores: <span id="totalMoradores">0</span></p>
      <p>Total de Correspondências Pendentes: <span id="totalPendentes">0</span></p>
      <p>Total de Correspondências Entregues: <span id="totalEntregues">0</span></p>
    </div>

    <!-- Correspondências -->
    <div id="correspondencias" class="content">
      <h2>Nova Correspondência</h2>
      <form id="form-correspondencia">
        <input type="text" id="nomeMorador" placeholder="Nome do Morador" required>
        <select id="tipoCorrespondencia" required>
          <option value="">Tipo</option>
          <option value="Carta">Carta</option>
          <option value="Encomenda">Encomenda</option>
        </select>
        <input type="date" id="dataRecebimento" required>
        <button type="submit">Adicionar</button>
      </form>
      <button class="btn btn-export" onclick="exportarCSV('pendentes')">Exportar Pendentes</button>
      <table id="tabela-pendentes">
        <thead><tr><th>Morador</th><th>Tipo</th><th>Data</th><th>Ações</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Entregues -->
    <div id="entregues" class="content">
      <h2>Correspondências Entregues</h2>
      <button class="btn btn-export" onclick="exportarCSV('entregues')">Exportar Entregues</button>
      <table id="tabela-entregues">
        <thead><tr><th>Morador</th><th>Tipo</th><th>Data</th><th>Ações</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Moradores -->
    <div id="moradores" class="content">
      <h2>Novo Morador</h2>
      <form id="form-morador">
        <input type="text" id="novoMorador" placeholder="Nome" required>
        <input type="text" id="apartamento" placeholder="Apartamento" required>
        <input type="text" id="telefone" placeholder="Telefone (WhatsApp)" required>
        <button type="submit">Adicionar</button>
      </form>
      <button class="btn btn-export" onclick="exportarCSV('moradores')">Exportar Moradores</button>
      <h3>Moradores</h3>
      <ul id="lista-moradores"></ul>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    function salvar(chave,dados){localStorage.setItem(chave,JSON.stringify(dados));}
    function carregar(chave){return JSON.parse(localStorage.getItem(chave))||[];}
    let moradores=carregar("moradores"),pendentes=carregar("pendentes"),entregues=carregar("entregues");

    function showSection(id){
      document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active'));
      document.querySelector(`.nav a[onclick="showSection('${id}')"]`).classList.add('active');
      atualizarDashboard();
    }
    function toast(msg,erro=false){
      const t=document.getElementById("toast");
      t.textContent=msg; t.className="toast show"+(erro?" error":"");
      setTimeout(()=>t.className="toast",3000);
    }
    function atualizarDashboard(){
      totalMoradores.textContent=moradores.length;
      totalPendentes.textContent=pendentes.length;
      totalEntregues.textContent=entregues.length;
    }

    function renderMoradores(){
      listaMoradores.innerHTML="";
      moradores.forEach((m,i)=>{
        let li=document.createElement("li");
        li.innerHTML=`${m.nome} - Ap: ${m.apto} - Tel: ${m.tel}
          <button class="btn btn-danger" onclick="removerMorador(${i})">Excluir</button>`;
        listaMoradores.appendChild(li);
      });
      salvar("moradores",moradores); atualizarDashboard();
    }
    function removerMorador(i){moradores.splice(i,1);renderMoradores();toast("Morador removido!");}
    formMorador.addEventListener("submit",e=>{
      e.preventDefault();
      moradores.push({nome:novoMorador.value,apto:apartamento.value,tel:telefone.value});
      renderMoradores(); e.target.reset(); toast("Morador cadastrado!");
    });

    function renderPendentes(){
      const tb=tabelaPendentes.querySelector("tbody"); tb.innerHTML="";
      pendentes.forEach((c,i)=>{
        let tr=document.createElement("tr");
        tr.innerHTML=`<td>${c.nome}</td><td>${c.tipo}</td><td>${c.data}</td>
          <td>
            <button class="btn btn-success" onclick="entregar(${i})">Entregar</button>
            <button class="btn btn-danger" onclick="removerPendente(${i})">Excluir</button>
          </td>`;
        tb.appendChild(tr);
      });
      salvar("pendentes",pendentes); atualizarDashboard();
    }
    function removerPendente(i){pendentes.splice(i,1);renderPendentes();toast("Correspondência removida!");}
    function entregar(i){
      entregues.push(pendentes[i]); pendentes.splice(i,1);
      renderPendentes(); renderEntregues(); salvar("entregues",entregues);
      toast("Correspondência entregue!");
      let m=moradores.find(x=>x.nome===entregues[entregues.length-1].nome);
      if(m&&m.tel){let msg=`Olá ${m.nome}, sua correspondência (${entregues[entregues.length-1].tipo}) já está disponível.`;
        window.open(`https://wa.me/${m.tel}?text=${encodeURIComponent(msg)}`,"_blank");}
    }
    formCorrespondencia.addEventListener("submit",e=>{
      e.preventDefault();
      pendentes.push({nome:nomeMorador.value,tipo:tipoCorrespondencia.value,data:dataRecebimento.value});
      renderPendentes(); e.target.reset(); toast("Correspondência registrada!");
    });

    function renderEntregues(){
      const tb=tabelaEntregues.querySelector("tbody"); tb.innerHTML="";
      entregues.forEach((c,i)=>{
        let tr=document.createElement("tr");
        tr.innerHTML=`<td>${c.nome}</td><td>${c.tipo}</td><td>${c.data}</td>
          <td><button class="btn btn-danger" onclick="removerEntregue(${i})">Excluir</button></td>`;
        tb.appendChild(tr);
      });
      salvar("entregues",entregues); atualizarDashboard();
    }
    function removerEntregue(i){entregues.splice(i,1);renderEntregues();toast("Entrega excluída!");}

    // Exportação CSV
    function exportarCSV(tipo){
      let dados=[];
      if(tipo==="moradores") dados=moradores;
      if(tipo==="pendentes") dados=pendentes;
      if(tipo==="entregues") dados=entregues;
      if(dados.length===0){toast("Sem dados para exportar!",true);return;}
      let csv=Object.keys(dados[0]).join(";")+"\n";
      dados.forEach(d=>{csv+=Object.values(d).join(";")+"\n";});
      let blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});
      let link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download=tipo+".csv";
      link.click();
    }

    renderMoradores();renderPendentes();renderEntregues();atualizarDashboard();
  </script>
</body>
</html>
